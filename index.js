const newDeck = [{
    card :  "2",
    suit :  "hearts",
    value : 2,
    id : "100",
    color : "red"
},{
    card :  "3",
    suit :  "hearts",
    value : 3,
    id : "101",
    color : "red"
},{
    card :  "4",
    suit :  "hearts",
    value : 4,
    id : "102",
    color : "red"
},{
    card :  "5",
    suit :  "hearts",
    value : 5,
    id : "103",
    color : "red"
},{
    card :  "6",
    suit :  "hearts",
    value : 6,
    id : "104",
    color : "red"
},{
    card :  "7",
    suit :  "hearts",
    value : 7,
    id : "105",
    color : "red"
},{
    card :  "8",
    suit :  "hearts",
    value : 8,
    id : "106",
    color : "red"
},{
    card :  "9",
    suit :  "hearts",
    value : 9,
    id : "107",
    color : "red"
},{
    card :  "10",
    suit :  "hearts",
    value : 10,
    id : "108",
    color : "red"
},{
    card :  "J",
    suit :  "hearts",
    value : 10,
    id : "109",
    color : "red"
},{
    card :  "Q",
    suit :  "hearts",
    value : 10,
    id : "110",
    color : "red"
},{
    card :  "K",
    suit :  "hearts",
    value : 10,
    id : "111",
    color : "red"
},{
    card :  "A",
    suit :  "hearts",
    value : 11,
    id : "112",
    color : "red"
},{
    card :  "2",
    suit :  "diamonds",
    value : 2,
    id : "113",
    color : "red"
},{
    card :  "3",
    suit :  "diamonds",
    value : 3,
    id : "114",
    color : "red"
},{
    card :  "4",
    suit :  "diamonds",
    value : 4,
    id : "115",
    color : "red"
},{
    card :  "5",
    suit :  "diamonds",
    value : 5,
    id : "116",
    color : "red"
},{
    card :  "6",
    suit :  "diamonds",
    value : 6,
    id : "117",
    color : "red"
},{
    card :  "7",
    suit :  "diamonds",
    value : 7,
    id : "118",
    color : "red"
},{
    card :  "8",
    suit :  "diamonds",
    value : 8,
    id : "119",
    color : "red"
},{
    card :  "9",
    suit :  "diamonds",
    value : 9,
    id : "120",
    color : "red"
},{
    card :  "10",
    suit :  "diamonds",
    value : 10,
    id : "121",
    color : "red"
},{
    card :  "J",
    suit :  "diamonds",
    value : 10,
    id : "122",
    color : "red"
},{
    card :  "Q",
    suit :  "diamonds",
    value : 10,
    id : "123",
    color : "red"
},{
    card :  "K",
    suit :  "diamonds",
    value : 10,
    id : "124",
    color : "red"
},{
    card :  "A",
    suit :  "diamonds",
    value : 11,
    id : "125",
    color : "red"
},{
    card :  "2",
    suit :  "spades",
    value : 2,
    id : "126",
    color : "black"
},{
    card :  "3",
    suit :  "spades",
    value : 3,
    id : "127",
    color : "black"
},{
    card :  "4",
    suit :  "spades",
    value : 4,
    id : "128",
    color : "black"
},{
    card :  "5",
    suit :  "spades",
    value : 5,
    id : "129",
    color : "black"
},{
    card :  "6",
    suit :  "spades",
    value : 6,
    id : "130",
    color : "black"
},{
    card :  "7",
    suit :  "spades",
    value : 7,
    id : "131",
    color : "black"
},{
    card :  "8",
    suit :  "spades",
    value : 8,
    id : "132",
    color : "black"
},{
    card :  "9",
    suit :  "spades",
    value : 9,
    id : "133",
    color : "black"
},{
    card :  "10",
    suit :  "spades",
    value : 10,
    id : "134",
    color : "black"
},{
    card :  "J",
    suit :  "spades",
    value : 10,
    id : "135",
    color : "black"
},{
    card :  "Q",
    suit :  "spades",
    value : 10,
    id : "136",
    color : "black"
},{
    card :  "K",
    suit :  "spades",
    value : 10,
    id : "137",
    color : "black"
},{
    card :  "A",
    suit :  "spades",
    value : 11,
    id : "138",
    color : "black"
},{
    card :  "2",
    suit :  "clubs",
    value : 2,
    id : "139",
    color : "black"
},{
    card :  "3",
    suit :  "clubs",
    value : 3,
    id : "140",
    color : "black"
},{
    card :  "4",
    suit :  "clubs",
    value : 4,
    id : "141",
    color : "black"
},{
    card :  "5",
    suit :  "clubs",
    value : 5,
    id : "142",
    color : "black"
},{
    card :  "6",
    suit :  "clubs",
    value : 6,
    id : "143",
    color : "black"
},{
    card :  "7",
    suit :  "clubs",
    value : 7,
    id : "144",
    color : "black"
},{
    card :  "8",
    suit :  "clubs",
    value : 8,
    id : "145",
    color : "black"
},{
    card :  "9",
    suit :  "clubs",
    value : 9,
    id : "146",
    color : "black"
},{
    card :  "10",
    suit :  "clubs",
    value : 10,
    id : "147",
    color : "black"
},{
    card :  "J",
    suit :  "clubs",
    value : 10,
    id : "148",
    color : "black"
},{
    card :  "Q",
    suit :  "clubs",
    value : 10,
    id : "149",
    color : "black"
},{
    card :  "K",
    suit :  "clubs",
    value : 10,
    id : "150",
    color : "black"
},{
    card :  "A",
    suit :  "clubs",
    value : 11,
    id : "151",
    color : "black"
}]

// use [...newDeck] to Clone the value instead of referencing to it
let deck = [...newDeck]

let totalWinsElement = document.getElementById("wins-el");
let totalLossesElement = document.getElementById("losses-el");
let totalBlackJacksElement = document.getElementById("blackjacks-el");
let totalWinsCountSpan = document.getElementById("wins");
let totalLossesCountSpan = document.getElementById("losses");
let totalBlackJacksCountSpan = document.getElementById("blackjacks");
let yourCardsElement = document.getElementById("your-cards-text");
let dealerCardsElement = document.getElementById("dealer-cards-text");
let playerSumElement = document.getElementById("playerTotalCountEl");
let dealerSumElement = document.getElementById("dealerTotalCountEl");
let dealerCardsBoard = document.getElementById("dealerCardsBoard");
let resultEl = document.getElementById("resultText");
let cardsLeftEl = document.getElementById("cardsLeftEl");
let hitButton = document.getElementById("hit-btn");
let standButton = document.getElementById("stand-btn");
let startButton = document.getElementById("start-btn");
let bugloopCounter = 0;
let newDeckButton;
let wins = 0;
let losses = 0;
let blackjacks =  0;


let dealerCards = [];
let myCards = [];
let totalSum = 0;
let totalSumDealer = 0;

totalLossesCountSpan.textContent = losses;
totalWinsCountSpan.textContent = wins;

function updateScore(){
    totalLossesCountSpan.textContent = losses;
    totalWinsCountSpan.textContent = wins;
    totalBlackJacksCountSpan.textContent = blackjacks;

}



// picks a card object from the deck array, removes it  and stores it in pickedCard, pushes it so myCards and Calls renderCard()
function pick(dealerTurn) {

    //disables function for player  when player is bust
    if (totalSum > 21 && dealerTurn != true){
        
        return
    }  
  
    //Dealer turn
    if (dealerTurn === true) {

        if (deck.length > 0) {
            let indexNumber = Math.floor(Math.random() * deck.length );
            pickedCard = deck[indexNumber]
            deck.splice(indexNumber, 1);
            cardsLeftEl.textContent = ("decksize is now " + deck.length);
            dealerCards.push(pickedCard)
            renderDealerCard(pickedCard) // dealer
            
             

        
        } else {
            // cardEl.textContent = "You are out of cards!";
            // newDeckButton = document.createElement("button");
            // newDeckButton.setAttribute("id", "newDeckButton");
            // newDeckButton.setAttribute("onclick", "reshuffle()");
            // newDeckButton.textContent = "Reshuffle Deck";
            // container.appendChild(newDeckButton)    
            
        }
        
    return pickedCard
        
    }  




    //Player turn
    if (dealerTurn != true) {

        if (deck.length > 0) {
            let indexNumber = Math.floor(Math.random() * deck.length );
            pickedCard = deck[indexNumber]
            deck.splice(indexNumber, 1);
            cardsLeftEl.textContent = ("decksize is now " + deck.length);
            console.log(pickedCard)
            myCards.push(pickedCard)
            renderCardPlayer(pickedCard)
        } else {
            cardEl.textContent = "The deck is empty!";
            newDeckButton = document.createElement("button");
            newDeckButton.setAttribute("id", "newDeckButton");
            newDeckButton.setAttribute("onclick", "reshuffle()");
            newDeckButton.textContent = "Reshuffle Deck";
            container.appendChild(newDeckButton)    
            
        }
        
    return pickedCard
        
    }      
        
}



// render dealerCard
function renderDealerCard(pickedCard){
    let newCard;
    let suit;
    let color;
    
    switch (pickedCard.suit) {
        case "hearts":
            suit = "♥"
            color = "red"
            break;
        case "spades":
            suit = "♠"
            color = "black"
            break;
        case "clubs":
            suit = "♣"
            color = "black"
            break;
        case "diamonds":
            suit = "♦"
            color = "red"
            break;
        default:
            break;
    }

    newCard = document.createElement("div");
    newCard.setAttribute("class","card");
    newCard.classList.add(color);
    newCard.setAttribute("id",pickedCard.id);
    
    newCard.textContent = (suit)
    newCard.textContent += (pickedCard.card)
    dealerCardsBoard.appendChild(newCard);
    sumValDealer(dealerCards)

}










// renders a player card out of the card object
function renderCardPlayer(pickedCard){
        let newCard;
        let suit;
        let color;
        switch (pickedCard.suit) {
            case "hearts":
                suit = "♥"
                color = "red"
                break;
            case "spades":
                suit = "♠"
                color = "black"
                break;
            case "clubs":
                suit = "♣"
                color = "black"
                break;
            case "diamonds":
                suit = "♦"
                color = "red"
                break;
            default:
                break;
        }

        newCard = document.createElement("div");
        newCard.setAttribute("class","card");
        newCard.classList.add(color);
        newCard.setAttribute("id",pickedCard.id);
        
        newCard.textContent = (suit)
        newCard.textContent += (pickedCard.card)
        myCardsBoard.appendChild(newCard);
        sumValPlayer(myCards)

}

// re-adds all the cards to the deck
function reshuffle(){
        deck = [...newDeck]
        cardsLeftEl.textContent = ("decksize is now " + deck.length)
        newDeckButton.remove();
}

// sums up players cards values
function sumValPlayer(myCards){
    let sumPlayer = 0;
       myCards.forEach(myCards => {
        sumPlayer += (myCards.value);
       });
       
       totalSum = sumPlayer;
    
       //////////////////// Code that checks IF Aces need to be 1

       if (totalSum > 21) {
            myCards.forEach(cardEntry => {
                if (cardEntry.card === "A" && cardEntry.value === 11 && totalSum > 21) {
                    cardEntry.value = 1;
                    console.log("value of A changed to "+ cardEntry.value )
                    console.log("Total sum was "+ totalSum + "and sumPlayer was" +sumPlayer) 
                    return sumValPlayer(myCards)

                } else console.log("No Ace found")
            });
        }
        ///////////////////////////////////

       playerSumElement.textContent = "Your current count is: " + (totalSum) + "!";
      
       
       if (totalSum === 21){
        endGame(false)
       }
       
       
       if (totalSum > 21) {
        endGame(true);
        
        
    }

}


// sums up dealer cards values
function sumValDealer(dealerCards){
    let sumDealer = 0;
       dealerCards.forEach(dealerCards => {
        sumDealer += (dealerCards.value);
       });
       totalSumDealer = sumDealer;


       //////////////////// insert A's code here
       
       
       if (totalSumDealer > 21) {
        dealerCards.forEach(cardEntry => {
            if (cardEntry.card === "A" && cardEntry.value === 11 && totalSumDealer > 21) {
                cardEntry.value = 1;
                console.log("value of A changed to "+ cardEntry.value )
                console.log("Total sum was "+ totalSumDealer + "and sumDealer was" +sumDealer) 
                return sumValDealer(dealerCards)

            } else console.log("No Ace found for dealer")
        });
    }
       
 
       
       ///////////////////////////////////////////
       
       if (dealerCards.length < 2) {
        console.log("totalSumDealer = "+totalSumDealer + "sumDealer = "+sumDealer)
       }
       
       dealerSumElement.textContent = "Dealer sum: " + (totalSumDealer) + "!";

      }



function startGame(){
    bugloopCounter = 0;
    resultEl.hidden = true;
    resultEl.innerText = " "
    totalLossesElement.hidden = false;
    totalWinsElement.hidden = false;
    totalBlackJacksElement.hidden = false;
    playerSumElement.classList.remove("bustedText");
    myCards.forEach(cardEntry => {
        console.log(cardEntry.id)
        document.getElementById(cardEntry.id).remove()
    });
    
    myCards = [];
    totalSum = 0

    dealerCards.forEach(dealerCardEntry => {
        console.log(dealerCardEntry.id)
        document.getElementById(dealerCardEntry.id).remove()
    });
    
    dealerCards = [];
    totalSumDealer = 0;
    
    standButton.hidden = false;
    hitButton.hidden = false;
    deck = [...newDeck]; // dit moet nog anders maar voor testing laten
    
    startButton.classList.add("displayNone");
    pick(true);        // <------ first pick dealer card  to fix problem below (640)
    pick(false);
    pick(false);
    dealerCardsElement.hidden = false;
    yourCardsElement.hidden = false;
    
      
}


// scores are matched at the end of the turn
function endPlayerTurn(stand,totalSum){
        console.log ( totalSum + "blabla") 
        console.log ("player stand = " + stand)
        console.log (totalSumDealer) ////////// <---- this SHOULD have the value of the first Card but was 0 when player had BJ HoleCards
        
        

        if (totalSumDealer === 0 && bugloopCounter < 5) {         
            sumValDealer(dealerCards)
            endPlayerTurn(true,totalSum)
            console.log("totalSumDealer(fixloop) = " + totalSumDealer)
            bugloopCounter++
            return
        } else {
            
            while (totalSumDealer < 17) {
                pick(true);
            }

        }



        //un-hides result element
        resultEl.hidden = false;
        
        
        if (totalSum >21 ) { 
            console.log("Busted!, You lost")
            resultEl.hidden = false;
            resultEl.textContent = "Busted!, You lost"
            losses++
            updateScore()
            return
        } 

        //Blackjacks
        if (totalSum === 21) {
            if (totalSumDealer === 21){
                console.log("Draw!");
                resultEl.hidden = false;
                resultEl.textContent = "Draw!";
                blackjacks++;
                updateScore()
                return
            } 
            else {
                console.log("Black Jack! 2x wager")
                resultEl.hidden = false;
                resultEl.textContent = "Black Jack! 2x wager";
                wins++;
                blackjacks++;
                updateScore()
                return
            }   
        }
        
        if (totalSumDealer === 21) { /// werkt!
            console.log("You lose, Dealer has Black Jack")
            resultEl.hidden = false;
            resultEl.textContent = "You lose, Dealer has Black Jack";
            losses++
            updateScore()
            return
        }

        //Dealer bust, player alive
        if (totalSumDealer > 21 && totalSum <22) { 
            console.log("You win! Dealer bust")
            resultEl.hidden = false;
            resultEl.textContent = "You win! Dealer bust";
            wins++
            updateScore()
            return
        }

        if (totalSumDealer === totalSum) {
            console.log("Draw")
            resultEl.hidden = false;
            resultEl.textContent = "Draw"
            updateScore()
            return
        }

        if (totalSumDealer > totalSum){
            console.log("You lose, Dealer had: " + totalSumDealer + " While you had: " + totalSum)
            resultEl.hidden = false;
            resultEl.textContent = "You lose! " + totalSum + " VS " + totalSumDealer;
            losses++
            updateScore()
            return
        } else {
            console.log("You Win! You had: " + totalSum + " vs. the dealers " + totalSumDealer )
            resultEl.hidden = false;
            resultEl.textContent = "You Win! " + totalSum + " VS " + totalSumDealer 
            wins++
            updateScore()
            return
        }


    }




// gets called by stand button or sumValPlayer (bust=true/ BJ= false)
function endGame(bust){
   console.log(bust)
    if (bust === true) {
        resultEl.hidden = false;
        resultEl.textContent = "Busted! Your total was " + totalSum;
        playerSumElement.classList.add("bustedText");
        playerSumElement.textContent = null
        
        hitButton.hidden = true;
        standButton.hidden = true;
        startButton.classList.remove("displayNone")
        losses++
        totalLossesCountSpan.textContent = losses
        totalWinsCountSpan.textContent = wins
    } else { //stand
        playerSumElement.classList.add("bustedText"); // same
        playerSumElement.textContent = "Your total is " + totalSum;
        
        hitButton.hidden = true;
        standButton.hidden = true;
        startButton.classList.remove("displayNone")
        totalLossesCountSpan.textContent = losses
        totalWinsCountSpan.textContent = wins
        endPlayerTurn(true, totalSum)
    }
}

